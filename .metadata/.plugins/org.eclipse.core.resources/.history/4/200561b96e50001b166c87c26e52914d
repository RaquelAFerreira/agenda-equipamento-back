package br.com.alterdata.agendaEquipamento.services;

import java.util.List;
import java.util.Optional;

import javax.transaction.Transactional;

import br.com.alterdata.agendaEquipamento.exceptions.EquipamentoDuplicadoException;
import br.com.alterdata.agendaEquipamento.exceptions.LoginDuplicadoException;
import br.com.alterdata.agendaEquipamento.models.Equipamento;
import br.com.alterdata.agendaEquipamento.repositorys.EquipamentoRepository;

public class EquipamentoService {

	EquipamentoRepository equipamentoRepository;
	
	@Transactional
	public Equipamento create(Equipamento equipamento) throws EquipamentoDuplicadoException{
		Equipamento equipamentoEncontrado = equipamentoRepository.getWithCodigoEquipamento(equipamento.getCodigoEquipamento());
		if (equipamentoEncontrado == null) {
			return equipamentoRepository.save(equipamento);	
		} else {
			throw new EquipamentoDuplicadoException(equipamento.getCodigoEquipamento());
		}
	}
	
	@Transactional
	public Equipamento getByEquipamento(String codigoEquipamento){
		return equipamentoRepository.getWithCodigoEquipamento(codigoEquipamento);
	}

	@Transactional
	public List<Equipamento> getAll(){
		List<Equipamento> equipamentos = equipamentoRepository.findAll();
		return equipamentos;
	}
	
	@Transactional
	public Optional<Equipamento> getbyId(Integer id){
		return equipamentoRepository.findById(id);
	}
	
	@Transactional
	public boolean delete(Integer id){
		Optional<Equipamento> equipamento = equipamentoRepository.findById(id);
		
		if (equipamento.isPresent()) {
			equipamentoRepository.delete(equipamento.get());
			return true; 
		} else {
			return false;
		}
		
	}
	
	@Transactional
	public Equipamento update(Integer id, Equipamento equipamento){
		Optional<Equipamento> equipamentoSelecionado = equipamentoRepository.findById(id);
		Equipamento equipamentoAtualizado = equipamentoSelecionado.get();
		
		if (equipamento.getCpf().equals("") == false && equipamento.getCpf() != null) {
			equipamentoAtualizado.setCpf(equipamento.getCpf());
		}
		
		if (equipamento.getNome().equals("") == false && equipamento.getNome() != null) {
			equipamentoAtualizado.setNome(equipamento.getNome());
		}
		
		if (equipamento.getLogin().equals("") == false && equipamento.getLogin() != null) {
			equipamentoAtualizado.setLogin(equipamento.getLogin());
		}
		
		if (equipamento.getSenha().equals("") == false && equipamento.getSenha() != null) {
			equipamentoAtualizado.setSenha(equipamento.getSenha());
		}
		
		return equipamentoRepository.save(equipamentoAtualizado);
	}
}
