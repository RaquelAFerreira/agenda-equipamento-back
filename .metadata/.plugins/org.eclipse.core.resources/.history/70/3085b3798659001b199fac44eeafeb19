package br.com.alterdata.agendaEquipamento.services;
import java.util.Collections;
import java.util.List;
import java.util.Optional;

import javax.transaction.Transactional;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import br.com.alterdata.agendaEquipamento.exceptions.EquipamentoDuplicadoException;
import br.com.alterdata.agendaEquipamento.models.Equipamento;
import br.com.alterdata.agendaEquipamento.repositories.EquipamentoRepository;

@Service
public class EquipamentoService {

	@Autowired
	EquipamentoRepository equipamentoRepository;
	
	@Transactional
	public Equipamento create(Equipamento equipamento) throws EquipamentoDuplicadoException{
		Equipamento equipamentoEncontrado = equipamentoRepository.getByCodigoEquipamento(equipamento.getCodigoEquipamento());
		if (equipamentoEncontrado == null) {
			return equipamentoRepository.save(equipamento);	
		} else {
			throw new EquipamentoDuplicadoException(equipamento.getCodigoEquipamento());
		}
	}
	
	@Transactional
	public Equipamento getByCodigoEquipamento(String codigoEquipamento){
		return equipamentoRepository.getByCodigoEquipamento(codigoEquipamento);
	}
	
	@Transactional
	public Equipamento getByCategoria(String categoria){
		List<Equipamento> listaEquipamentos = equipamentoRepository.getByCategoria(categoria);
		return listaEquipamentos.stream().findFirst().get();
	}
	

	@Transactional
	public List<Equipamento> getAll(){
		List<Equipamento> sortedList = equipamentoRepository.findAll();
		Collections.sort(sortedList);
		return sortedList;
	}
	
	@Transactional
	public Optional<Equipamento> getbyId(Integer id){
		return equipamentoRepository.findById(id);
	}
	
	@Transactional
	public boolean delete(Integer id){
		Optional<Equipamento> equipamento = equipamentoRepository.findById(id);
		
		if (equipamento.isPresent()) {
			equipamentoRepository.delete(equipamento.get());
			return true; 
		} else {
			return false;
		}
	}
	
	@Transactional
	public Equipamento setEquipamentoIndisponivel(Integer id){
		Optional<Equipamento> equipamentoSelecionado = equipamentoRepository.findById(id);
		Equipamento equipamentoAtualizado = equipamentoSelecionado.get();
		equipamentoAtualizado.setDisponivel(false);
		return equipamentoRepository.save(equipamentoAtualizado);
	}
	
	@Transactional
	public Equipamento setEquipamentoDisponivel(Integer id){
		Optional<Equipamento> equipamentoSelecionado = equipamentoRepository.findById(id);
		Equipamento equipamentoAtualizado = equipamentoSelecionado.get();
		equipamentoAtualizado.setDisponivel(true);
		return equipamentoRepository.save(equipamentoAtualizado);
	}
	
	@Transactional
	public Equipamento update(Integer id, Equipamento equipamento){
		Optional<Equipamento> equipamentoSelecionado = equipamentoRepository.findById(id);
		Equipamento equipamentoAtualizado = equipamentoSelecionado.get();
		
		if (equipamento.getDescricao() != null) {
			equipamentoAtualizado.setDescricao(equipamento.getDescricao());
		}
		
		equipamentoAtualizado.setDisponivel(equipamento.isDisponivel());
		
		return equipamentoRepository.save(equipamentoAtualizado);
	}
}
