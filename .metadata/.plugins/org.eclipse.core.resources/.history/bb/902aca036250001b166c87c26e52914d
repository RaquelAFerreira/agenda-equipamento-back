package br.com.alterdata.agendaEquipamento.services;

import java.util.List;
import java.util.Optional;

import javax.transaction.Transactional;

import org.springframework.stereotype.Service;

import br.com.alterdata.agendaEquipamento.exceptions.SolicitacaoDuplicadaException;
import br.com.alterdata.agendaEquipamento.models.Solicitacao;
import br.com.alterdata.agendaEquipamento.repositorys.SolicitacaoRepository;

@Service
public class SolicitacaoService {
	
SolicitacaoRepository solicitacaoRepository;
	
	@Transactional
	public Solicitacao create(Solicitacao solicitacao) throws SolicitacaoDuplicadaException {
		Solicitacao solicitacaoEncontrada = solicitacaoRepository.getWithCodigoSolicitacao(solicitacao.getCodigoSolicitacao());
		if(solicitacaoEncontrada == null) {
			return solicitacaoRepository.save(solicitacao);	
		} else {
			throw new SolicitacaoDuplicadaException(solicitacao.getCodigoSolicitacao());
		}
	}
	
	@Transactional
	public Solicitacao getByCodigoSolicitacao(String codigoSolicitacao) {
		return solicitacaoRepository.getWithCodigoSolicitacao(codigoSolicitacao);
	}

	@Transactional
	public List<Solicitacao> getAll() {
		List<Solicitacao> solicitacaos = solicitacaoRepository.findAll();
		return solicitacaos;
	}
	
	@Transactional
	public Optional<Solicitacao> getbyId(Integer id) {
		return solicitacaoRepository.findById(id);
	}
	
	@Transactional
	public boolean delete(Integer id) {
		Optional<Solicitacao> solicitacao = solicitacaoRepository.findById(id);
		if(solicitacao.isPresent()) {
			solicitacaoRepository.delete(solicitacao.get());
			return true; 
		} else {
			return false;
		}
	}
	
	@Transactional
	public Solicitacao update(Integer id, Solicitacao solicitacao) {
		Optional<Solicitacao> solicitacaoSelecionado = solicitacaoRepository.findById(id);
		Solicitacao solicitacaoAtualizado = solicitacaoSelecionado.get();
		
		if(solicitacao.getCpf().equals("") == false && solicitacao.getCpf() != null) {
			solicitacaoAtualizado.setCpf(solicitacao.getCpf());
		}
		
		if(solicitacao.getNome().equals("") == false && solicitacao.getNome() != null) {
			solicitacaoAtualizado.setNome(solicitacao.getNome());
		}
		
		if(solicitacao.getLogin().equals("") == false && solicitacao.getLogin() != null) {
			solicitacaoAtualizado.setLogin(solicitacao.getLogin());
		}
		
		if(solicitacao.getSenha().equals("") == false && solicitacao.getSenha() != null) {
			solicitacaoAtualizado.setSenha(solicitacao.getSenha());
		}
		
		return solicitacaoRepository.save(solicitacaoAtualizado);
	}
	
	
}
